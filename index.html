<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>COLLECT the corn!</title>
  <style>
    @font-face { font-family:'ArcadeClassic'; src:url('assets/font/ARCADECLASSIC.TTF') format('truetype'); }
    body,.pixel-button,input,textarea,#thankyou { font-family:'ArcadeClassic',monospace; }
    body {
      background: url('assets/images/ChatGPT Image Jul 23, 2025, 02_33_11 PM.png') center/cover no-repeat;
      margin: 0; padding: 0; height:100vh; overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      color:#fff; text-shadow:1px 1px 2px #000;
    }
    .info-box {
      width:450px; background:rgba(0,0,0,0.6); padding:30px;
      border:3px solid #fff176; border-radius:10px;
      font-size:21px; line-height:1.6; margin-right:60px; text-align:left;
      z-index:1;
    }
    .info-box p { margin:12px 0; }
    .main-content {
      display:flex; flex-direction:column; align-items:center; text-align:center; z-index:1;
    }
    h1 {
      font-size:84px; animation:blink 1s infinite; margin-bottom:24px;
    }
    @keyframes blink { 0%,50%,100%{opacity:1} 25%,75%{opacity:0} }
    #emojiBox img {
      width:180px; height:180px; transition:transform .5s ease;
    }
    #emojiBox.active img { transform:scale(1.3) rotate(10deg); }
    .progress-container {
      width:180px; height:18px; background:#444;
      border:2px solid #fff176; border-radius:6px;
      overflow:hidden; margin:12px 0;
    }
    #progressBar { width:0; height:100%; background:#ffcc00; transition:width .3s ease; }
    .pixel-button {
      font-size:21px; padding:18px 30px;
      background:#ffcc00; color:#000; border:4px solid #000;
      cursor:pointer; margin:12px; transition:background .2s;
    }
    .pixel-button:hover{ background:#ffaa00 }
    .frame {
      width:450px; background:rgba(0,0,0,0.6);
      border:3px dashed #fff176; padding:30px; margin-top:30px;
      border-radius:10px; box-shadow:0 0 10px #00000088;
      display:flex; flex-direction:column; align-items:center; text-align:center;
    }
    input,textarea {
      width:100%; font-size:21px; padding:12px;
      background:#fffde7; border:2px solid #000;
      margin-bottom:18px; box-sizing:border-box;
    }
    textarea{ height:120px; resize:none; }
    .popcorn-gif {
      position:absolute; pointer-events:none;
      width:30px; height:30px; animation:pop 2s ease-out forwards;
    }
    @keyframes pop {
      0%{opacity:1;transform:translate(0,0) scale(1) rotate(0deg)}
      100%{opacity:0;transform:translate(var(--x),var(--y)) scale(0.7) rotate(var(--r))}
    }
    #thankyou {
      display:none; font-size:21px; color:#ff4444;
      margin-top:18px; text-align:center;
    }
    .crow {
      position:absolute; width:120px; height:120px;
      cursor:pointer; z-index:1000;
    }
    #bgToggleBtn {
      position:fixed; top:10px; right:10px;
      background:rgba(0,0,0,0.6); border:2px solid #fff176;
      color:#fff; padding:8px; border-radius:4px;
      cursor:pointer; z-index:2000;
    }
    /* Mobile styles */
    @media(max-width:768px){
      body{ flex-direction:column-reverse; overflow-y:auto; padding:10px; height:auto; }
      .info-box,.main-content{ width:100%; margin:0 0 20px; }
      .info-box{ margin-right:0; font-size:14px; padding:20px; }
      h1{ font-size:32px; animation:none; }
      #emojiBox img{ width:100px; height:100px; }
      .progress-container{ width:100px; height:12px; }
      .frame{ width:100%; padding:20px; }
      .pixel-button{ font-size:12px; padding:10px 16px; }
      input,textarea{ font-size:14px; padding:8px; }
      .crow{ display:none!important; }
    }
  </style>
</head>
<body>
  <button id="bgToggleBtn">üîä</button>

  <div class="info-box">
    <p>üåΩ <strong>Farm owner:</strong> Ng√¥ Quang Huy</p>
    <p>‚è≥ <strong>Harvest time:</strong> <span id="countdown">Loading...</span></p>
    <p>üßë‚Äçüåæ Need your help to collect the crops with me!</p>
  </div>

  <div class="main-content">
    <h1>COLLECT THE CORN</h1>
    <div id="emojiBox"><img src="assets/images/corn.png" alt="Corn"></div>
    <div class="progress-container"><div id="progressBar"></div></div>
    <p id="collectPrompt" style="display:none;">Leave a note to help me collect the crops</p>
    <button id="collectBtn" class="pixel-button" style="display:none;">TAP TO COLLECT</button>
    <button id="cookBtn" class="pixel-button" style="display:none;">COOK</button>
    <button id="reloadBtn" class="pixel-button" onclick="location.reload()" style="display:none;">RELOAD</button>
    <div class="frame">
      <input id="nameInput" type="text" placeholder="Your name (required)">
      <textarea id="wishInput" placeholder="Write your wish (required)..."></textarea>
      <p id="thankyou">THANK YOU SO MUCHHH!</p>
    </div>
  </div>

  <audio id="bgMusic" src="assets/music/praise-be-to-god-327557.mp3" preload="auto" loop></audio>
  <audio id="crowAudio" src="assets/music/crow effect.mp3" preload="auto"></audio>

  <script>
    // üéµ Music control
    const bgMusic = document.getElementById('bgMusic');
    const bgToggle = document.getElementById('bgToggleBtn');
    let bgPlaying = false;
    window.addEventListener('load',()=>{
      bgMusic.play().catch(()=>{});
      bgPlaying = true; bgToggle.textContent='üîä';
    });
    bgToggle.addEventListener('click',e=>{
      e.stopPropagation();
      bgPlaying ? (bgMusic.pause(), bgToggle.textContent='üîá') : (bgMusic.play().catch(()=>{}), bgToggle.textContent='üîä');
      bgPlaying = !bgPlaying;
    });

    // üê¶ Crow interaction (desktop only)
    const isMobile = window.matchMedia('(max-width:768px)').matches;
    if(!isMobile){
      let spawnCount = 5;
      function spawnCrows(){
        for(let i=0;i<spawnCount;i++){
          const c=document.createElement('img');
          c.src='assets/images/ChatGPT Image Jul 23, 2025, 05_03_14 PM.png';
          c.className='crow';
          c.style.left=Math.random()*80+'%';
          c.style.top=Math.random()*80+'%';
          document.body.appendChild(c);
        }
      }
      spawnCrows();
      document.body.addEventListener('click', e=>{
        if(e.target.classList.contains('crow')){
          document.getElementById('crowAudio').play();
          e.target.remove();
          setTimeout(spawnCrows, spawnCount === 5 ? 1000 : 0);
        }
      });
    }

    // üîÅ Collect ‚Üí Cook logic
    let collectCount=0, maxCollect=4;
    const progressBar = document.getElementById('progressBar');
    const collectBtn = document.getElementById('collectBtn');
    const cookBtn = document.getElementById('cookBtn');
    const reloadBtn = document.getElementById('reloadBtn');
    const emojiBox = document.getElementById('emojiBox');
    const nameInput = document.getElementById('nameInput');
    const wishInput = document.getElementById('wishInput');
    const collectPrompt = document.getElementById('collectPrompt');
    const thankyou = document.getElementById('thankyou');

    function updateCollectUI(){
      const ready = nameInput.value.trim() && wishInput.value.trim();
      collectPrompt.style.display = ready ? 'block' : 'none';
      collectBtn.style.display = ready ? 'inline-block' : 'none';
    }

    nameInput.addEventListener('input', updateCollectUI);
    wishInput.addEventListener('input', updateCollectUI);
    updateCollectUI();

    collectBtn.addEventListener('click', ()=>{
      collectCount++;
      progressBar.style.width = (collectCount/maxCollect*100)+'%';
      emojiBox.innerHTML = '';
      for(let i=0;i<collectCount;i++){
        const img = document.createElement('img');
        img.src = 'assets/images/corn.png';
        img.width=50; img.height=50;
        emojiBox.appendChild(img);
      }
      if(collectCount===maxCollect){
        collectPrompt.style.display='none';
        collectBtn.style.display='none';
        startCookProcess();
      }
    });

    function startCookProcess(){
      let t=3;
      cookBtn.style.display='inline-block';
      cookBtn.disabled=true;
      cookBtn.textContent=`COOK (${t})`;
      const iv = setInterval(()=>{
        t--;
        cookBtn.textContent = t>0 ? `COOK (${t})` : 'COOKED!';
        if(t<0){ clearInterval(iv); transformCorn(); }
      },1000);
    }

    function transformCorn(){
      emojiBox.innerHTML = `<img src="assets/images/popcorn_transparent.png" width="120" height="120">`;
      emojiBox.classList.add('active');
      const count = isMobile ? 50 : 200;
      for(let i=0;i<count;i++) createPopcornGIF(emojiBox);
      reloadBtn.style.display = 'inline-block';

      // Send to Formspree
      fetch("https://formspree.io/f/mwpqlnln", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
          name: nameInput.value.trim(),
          wish: wishInput.value.trim()
        })
      }).then(res=>{
        if(res.ok) thankyou.style.display='block';
      }).catch(console.error);
    }

    function createPopcornGIF(origin){
      const gif = document.createElement('img');
      gif.className='popcorn-gif';
      gif.src='assets/images/popcorn tiny.png';
      const rect = origin.getBoundingClientRect();
      gif.style.left = `${rect.left + rect.width/2}px`;
      gif.style.top = `${rect.top + rect.height/2}px`;
      const x = (Math.random()-0.5)*2*window.innerWidth;
      const y = (Math.random()-0.5)*2*window.innerHeight;
      const r = `${Math.random()*360}deg`;
      gif.style.setProperty('--x',`${x}px`);
      gif.style.setProperty('--y',`${y}px`);
      gif.style.setProperty('--r',r);
      document.body.appendChild(gif);
      setTimeout(()=>gif.remove(),2000);
    }

    // ‚è≥ Countdown timer
    function updateCountdown(){
      const target = new Date("2025-09-14T09:00:00+07:00");
      const now = new Date(), diff = target - now;
      if(diff>0){
        const h = String(Math.floor(diff/3600000)).padStart(2,'0'),
              m = String(Math.floor((diff/60000)%60)).padStart(2,'0'),
              s = String(Math.floor((diff/1000)%60)).padStart(2,'0');
        document.getElementById('countdown').textContent = `${h}:${m}:${s}`;
      } else {
        document.getElementById('countdown').textContent = "It's harvest time!";
      }
    }
    setInterval(updateCountdown,1000);
    updateCountdown();
  </script>
</body>
</html>
